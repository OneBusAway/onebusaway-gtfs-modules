<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/apt/onebusaway-gtfs-merge-cli.apt.vm at 2024-02-01
 | Rendered using Apache Maven Fluido Skin 1.11.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>onebusaway-gtfs-modules &#x2013; GTFS Merge Command-Line Application</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.11.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.11.1.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="http://developer.onebusaway.org/" id="bannerLeft"><img src="http://developer.onebusaway.org/images/OneBusAway.png"  alt="OneBusAway" style="" /></a></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2024-02-01</li>
          <li id="projectVersion" class="pull-right"><span class="divider">|</span>Version: 1.4.16-SNAPSHOT</li>
        <li class="pull-right"><a href="../" title="GitHub Project">GitHub Project</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Introduction</li>
    <li><a href="index.html" title="About"><span class="none"></span>About</a></li>
    <li><a href="../" title="GitHub Project"><span class="none"></span>GitHub Project</a></li>
    <li><a href="release-notes.html" title="Release Notes"><span class="none"></span>Release Notes</a></li>
    <li><a href="apidocs/index.html" title="API Javadoc"><span class="none"></span>API Javadoc</a></li>
    <li><a href="onebusaway-gtfs-hibernate-cli.html" title="GTFS Database Loader"><span class="none"></span>GTFS Database Loader</a></li>
    <li><a href="onebusaway-gtfs-transformer-cli.html" title="GTFS Transformer"><span class="none"></span>GTFS Transformer</a></li>
    <li class="active"><a><span class="none"></span>GTFS Merge</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
   <li class="nav-header">Modules</li>
    <li><a href="onebusaway-gtfs/index.html" title="onebusaway-gtfs"><span class="none"></span>onebusaway-gtfs</a></li>
    <li><a href="onebusaway-gtfs-hibernate/index.html" title="onebusaway-gtfs-hibernate"><span class="none"></span>onebusaway-gtfs-hibernate</a></li>
    <li><a href="onebusaway-gtfs-hibernate-cli/index.html" title="onebusaway-gtfs-hibernate-cli"><span class="none"></span>onebusaway-gtfs-hibernate-cli</a></li>
    <li><a href="onebusaway-gtfs-transformer/index.html" title="onebusaway-gtfs-transformer"><span class="none"></span>onebusaway-gtfs-transformer</a></li>
    <li><a href="onebusaway-gtfs-transformer-cli/index.html" title="onebusaway-gtfs-transformer-cli"><span class="none"></span>onebusaway-gtfs-transformer-cli</a></li>
    <li><a href="onebusaway-gtfs-transformer-cli-aws/index.html" title="onebusaway-gtfs-transformer-cli-aws"><span class="none"></span>onebusaway-gtfs-transformer-cli-aws</a></li>
    <li><a href="onebusaway-gtfs-merge/index.html" title="onebusaway-gtfs-merge"><span class="none"></span>onebusaway-gtfs-merge</a></li>
    <li><a href="onebusaway-gtfs-merge-cli/index.html" title="onebusaway-gtfs-merge-cli"><span class="none"></span>onebusaway-gtfs-merge-cli</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<section>
<h2><a name="Introduction"></a>Introduction</h2>
<p><b>NOTE</b>: This tool is a work in progress! This documentation may not be up-to-date.</p>
<p>The <code>onebusaway-gtfs-merge-cli</code> command-line application is a simple command-line tool for merging <a class="externalLink" href="https://developers.google.com/transit/gtfs">GTFS</a> feeds. </p></section><section>
<h2><a name="Getting_the_Application"></a>Getting the Application</h2>
<p>You can download the application here:</p>
<p><a class="externalLink" href="https://repo.camsys-apps.com/snapshots/org/onebusaway/onebusaway-gtfs-merge-cli/1.4.16-SNAPSHOT/onebusaway-gtfs-merge-cli-1.4.16-SNAPSHOT.jar">onebusaway-gtfs-merge-cli-1.4.16-SNAPSHOT.jar</a></p></section><section>
<h2><a name="Using_the_Application"></a>Using the Application</h2>
<p>You'll need a Java 11 runtime installed to run the client. To run the application:</p>
<div class="source"><pre class="prettyprint">java -jar onebusaway-gtfs-merge-cli.jar [--args] input_gtfs_path_a input_gtfs_path_b ... output_gtfs_path</pre></div>
<p><b>Note</b>: Merging large GTFS feeds is often processor and memory intensive. You'll likely need to increase the max amount of memory allocated to Java with an option like <code>-Xmx1G</code> (adjust the limit as needed). I also recommend adding the <code>-server</code> argument if you are running the Oracle or OpenJDK, as it can really increase performance. </p></section><section>
<h2><a name="Configuring_the_Application"></a>Configuring the Application</h2>
<p>The merge application supports a number of options and arguments for configuring the application's behavior. The general pattern is to specify options for each type of file in a GTFS feed using the <code>--file</code> option, specifying specific options for each file type after the <code>--file</code> option. Here's a quick example:</p>
<div class="source"><pre class="prettyprint">--file=routes.txt --duplicateDetection=identity --file=calendar.txt --logDroppedDuplicates ...</pre></div>
<p>The merge application supports merging the following files:</p>
<ul>
<li><code>agency.txt</code></li>
<li><code>stops.txt</code></li>
<li><code>routes.txt</code></li>
<li><code>trips.txt</code> and <code>stop_times.txt</code></li>
<li><code>calendar.txt</code> and <code>calendar_dates.txt</code> </li>
<li><code>shapes.txt</code></li>
<li><code>fare_attributes.txt</code></li>
<li><code>fare_rules.txt</code></li>
<li><code>frequencies.txt</code></li>
<li><code>transfers.txt</code></li></ul>
<p>You can specify merge options for each of these files using the <code>--file=gtfs_file.txt</code> option. File types listed together (eg. <code>trips.txt&gt;&gt; and &lt;&lt;&lt;stop_times.txt</code>) are handled by the same merge strategy, so specifying options for either will have the same effect. For details on options you might specify, read on.</p></section><section>
<h2><a name="Handling_Duplicates"></a>Handling Duplicates</h2>
<p>The main issue to considering when merging GTFS feeds is the handling of duplicate entries between the two feeds, including how to identify duplicates and what to do with duplicates when they are found.</p><section>
<h3><a name="Identifying_Duplicates"></a>Identifying Duplicates</h3>
<p>We support a couple of methods for determining when entries from two different feeds are actually duplicates. By default, the merge tool will attempt to automatically determine the best merge strategy to use. You can also control the specific strategy used on a per-file basis using the <code>--duplicateDetection</code> argument. You can specify any of the following strategies for duplicate detection.</p>
<ul>
<li><code>--duplicateDetection=identity</code> - If two entries have the same id (eg. stop id, route id, trip id), then they are considered the same. This is the more strict matching policy.</li>
<li><code>--duplicateDetection=fuzzy</code> - If two entries have common elements (eg. stop name or location, route short name, trip stop sequence), then they are considered the same. This is the more lenient matching policy, and is highly dependent on the type of GTFS entry being matched.</li>
<li><code>--duplicateDetection=none</code> - Entries between two feeds are never considered to be duplicates, even if they have the same id or similar properties.</li></ul></section><section>
<h3><a name="Logging_Duplicates"></a>Logging Duplicates</h3>
<p>Sometimes your feed might have unexpected duplicates. You can tell the merge tool to log duplicates it finds or even immediately exit with the following arguments:</p>
<ul>
<li><code>--logDroppedDuplicates</code> - log a message when a duplicate is found</li>
<li><code>--errorOnDroppedDuplicates</code> - throw an exception when a duplicate is found, stopping the program</li></ul></section></section><section>
<h2><a name="Examples"></a>Examples</h2><section>
<h3><a name="Handling_a_Service_Change"></a>Handling a Service Change</h3>
<p>Agencies often schedule major changes to their system around a particular date, with one GTFS feed for before the service change and a different GTFS feed for after. We'd like to be able to merge these disjoint feeds into one feed with continuous coverage.</p>
<p>In our example, an agency produces two feeds where the entries in <code>agency.txt</code> and <code>stops.txt</code> are exactly the same, so the default policy of identifying and dropping duplicates will work fine there. The <code>routes.txt</code> file is a bit trickier, since the route ids are different between the two feeds but the entries are largely the same. We will use fuzzy duplicate detection to match the routes between the two feeds.</p>
<p>The next issue is the <code>calendar.txt</code> file. The agency uses the same <code>service_id</code> values in both feeds (eg. <code>WEEK</code>, <code>SAT</code>, <code>SUN</code>) with different start and end dates in the two feeds. If the default policy of dropping duplicate entries was used, we'd lose the dates in one of the service periods. Instead, we rename duplicates such that the service ids from the second feed will be renamed to <code>b-WEEK</code>, <code>b-SAT</code>, etc. and all <code>trips.txt</code> entries in the second feed will be updated appropriately. The result is that trips from the first and second feed will both have the proper calendar entries in the merged feed.</p>
<p>Putting it all together, here is what the command-line options for the application would look like:</p>
<div class="source"><pre class="prettyprint">--file=routes.txt --fuzzyDuplicates --file=calendar.txt --renameDuplicates</pre></div></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2024
<a href="http://onebusaway.org/">OneBusAway</a>
</p>
        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>
