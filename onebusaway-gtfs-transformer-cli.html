<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/apt/onebusaway-gtfs-transformer-cli.apt.vm at 2023-10-11
 | Rendered using Apache Maven Fluido Skin 1.11.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <meta name="author" content="Brian Ferris" />
    <meta name="date" content="2011-08-17" />
    <title>onebusaway-gtfs-modules &#x2013; GTFS Transformation Command-Line Application</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.11.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.11.1.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="http://developer.onebusaway.org/" id="bannerLeft"><img src="http://developer.onebusaway.org/images/OneBusAway.png"  alt="OneBusAway" style="" /></a></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2023-10-11</li>
          <li id="projectVersion" class="pull-right"><span class="divider">|</span>Version: 1.4.8</li>
        <li class="pull-right"><a href="../" title="GitHub Project">GitHub Project</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Introduction</li>
    <li><a href="index.html" title="About"><span class="none"></span>About</a></li>
    <li><a href="../" title="GitHub Project"><span class="none"></span>GitHub Project</a></li>
    <li><a href="release-notes.html" title="Release Notes"><span class="none"></span>Release Notes</a></li>
    <li><a href="apidocs/index.html" title="API Javadoc"><span class="none"></span>API Javadoc</a></li>
    <li><a href="onebusaway-gtfs-hibernate-cli.html" title="GTFS Database Loader"><span class="none"></span>GTFS Database Loader</a></li>
    <li class="active"><a><span class="none"></span>GTFS Transformer</a></li>
    <li><a href="onebusaway-gtfs-merge-cli.html" title="GTFS Merge"><span class="none"></span>GTFS Merge</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
   <li class="nav-header">Modules</li>
    <li><a href="onebusaway-gtfs/index.html" title="onebusaway-gtfs"><span class="none"></span>onebusaway-gtfs</a></li>
    <li><a href="onebusaway-gtfs-hibernate/index.html" title="onebusaway-gtfs-hibernate"><span class="none"></span>onebusaway-gtfs-hibernate</a></li>
    <li><a href="onebusaway-gtfs-hibernate-cli/index.html" title="onebusaway-gtfs-hibernate-cli"><span class="none"></span>onebusaway-gtfs-hibernate-cli</a></li>
    <li><a href="onebusaway-gtfs-transformer/index.html" title="onebusaway-gtfs-transformer"><span class="none"></span>onebusaway-gtfs-transformer</a></li>
    <li><a href="onebusaway-gtfs-transformer-cli/index.html" title="onebusaway-gtfs-transformer-cli"><span class="none"></span>onebusaway-gtfs-transformer-cli</a></li>
    <li><a href="onebusaway-gtfs-transformer-cli-aws/index.html" title="onebusaway-gtfs-transformer-cli-aws"><span class="none"></span>onebusaway-gtfs-transformer-cli-aws</a></li>
    <li><a href="onebusaway-gtfs-merge/index.html" title="onebusaway-gtfs-merge"><span class="none"></span>onebusaway-gtfs-merge</a></li>
    <li><a href="onebusaway-gtfs-merge-cli/index.html" title="onebusaway-gtfs-merge-cli"><span class="none"></span>onebusaway-gtfs-merge-cli</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<section>
<h2><a name="Introduction"></a>Introduction</h2>
<p>The <code>onebusaway-gtfs-transformer-cli</code> command-line application is a simple command-line tool for transforming <a class="externalLink" href="https://developers.google.com/transit/gtfs">GTFS</a> feeds.</p>
<ul>
<li><a href="#Introduction">Introduction</a></li>
<li><a href="#Requirements">Requirements</a></li>
<li><a href="#Getting_the_Application">Getting the Application</a></li>
<li><a href="#Using_the_Application">Using the Application</a></li>
<li><a href="#input_gtfs_path_and_output_gtfs_path_can_be_either_a_directory_containing_a_GTFS_feed_or_a_.zip_file.">input_gtfs_path and output_gtfs_path can be either a directory containing a GTFS feed or a .zip file.</a>
<ul>
<li><a href="#Arguments">Arguments</a></li>
<li><a href="#Transform_Syntax">Transform Syntax</a></li></ul></li>
<li><a href="#Matching">Matching </a>
<ul>
<li><a href="#Regular_Expressions">Regular Expressions</a></li>
<li><a href="#Compound_Property_Expressions">Compound Property Expressions</a></li>
<li><a href="#Multi-Value_Matches">Multi-Value Matches</a></li>
<li><a href="#Collection-Like_Entities">Collection-Like Entities</a></li></ul></li>
<li><a href="#Types_of_Transforms">Types of Transforms</a>
<ul>
<li><a href="#Add_an_Entity">Add an Entity</a></li>
<li><a href="#Update_an_Entity">Update an Entity</a>
<ul>
<li><a href="#Find.2FReplace">Find/Replace</a></li>
<li><a href="#Path_Expressions">Path Expressions </a></li></ul></li>
<li><a href="#Retain_an_Entity">Retain an Entity</a></li>
<li><a href="#Remove_an_Entity">Remove an Entity</a></li>
<li><a href="#Trim_a_Trip">Trim a Trip</a></li>
<li><a href="#Generate_Stop_Times">Generate Stop Times</a></li>
<li><a href="#Extend_Service_Calendars">Extend Service Calendars</a></li>
<li><a href="#Deduplicate_Calendar_Entries">Deduplicate Calendar Entries</a></li>
<li><a href="#Merge_Trips_and_Simplify_Calendar_Entries">Merge Trips and Simplify Calendar Entries</a></li>
<li><a href="#Shift_Negative_Stop_Times">Shift Negative Stop Times</a></li>
<li><a href="#Remove_non-revenue_stops">Remove non-revenue stops</a></li>
<li><a href="#Replacing_trip_headsign_with_the_last_stop">Replacing trip_headsign with the last stop</a></li>
<li><a href="#Arbitrary_Transform">Arbitrary Transform</a></li></ul></li>
<li><a href="#Additional_Examples">Additional Examples</a>
<ul>
<li><a href="#How_to_Reduce_your_GTFS">How to Reduce your GTFS</a></li>
<li><a href="#Add_a_Full_Schedule_to_an_Existing_Feed">Add a Full Schedule to an Existing Feed</a></li></ul></li></ul></section><section>
<h2><a name="Requirements"></a>Requirements</h2>
<ul>
<li>Java 11 or greater</li></ul></section><section>
<h2><a name="Getting_the_Application"></a>Getting the Application</h2>
<p>You can download the application here:</p>
<p><a class="externalLink" href="https://repo.camsys-apps.com/releases/org/onebusaway/onebusaway-gtfs-transformer-cli/1.4.8/onebusaway-gtfs-transformer-cli-1.4.8.jar">onebusaway-gtfs-transformer-cli-1.4.8.jar</a></p></section><section>
<h2><a name="Using_the_Application"></a>Using the Application</h2>
<p>To run the application:</p>
<div class="source"><pre class="prettyprint">java -jar onebusaway-gtfs-transformer-cli.jar [-args] input_gtfs_path ... output_gtfs_path</pre></div></section><section>
<h2><a name="input_gtfs_path_and_output_gtfs_path_can_be_either_a_directory_containing_a_GTFS_feed_or_a_.zip_file."></a><code>input_gtfs_path</code> and <code>output_gtfs_path</code> can be either a directory containing a GTFS feed or a .zip file.</h2>
<p><b>Note</b>: Transforming large GTFS feeds is processor and memory intensive. You'll likely need to increase the max amount of memory allocated to Java with an option like <code>-Xmx1G</code> or greater. Adding the <code>-server</code> argument if you are running the Oracle or OpenJDK can also increase performance. </p><section>
<h3><a name="Arguments"></a>Arguments</h3>
<ul>
<li><code>--transform=...</code> : specify a transformation to apply to the input GTFS feed (see syntax below)</li>
<li><code>--agencyId=id</code> : specify a default agency id for the input GTFS feed</li>
<li><code>--overwriteDuplicates</code> : specify that duplicate GTFS entities should overwrite each other when read</li></ul></section><section>
<h3><a name="Transform_Syntax"></a>Transform Syntax</h3>
<p>Transforms are specified as snippets of example. A simple example to remove a stop might look like:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;remove&quot;,&quot;match&quot;:{&quot;file&quot;:&quot;stops.txt&quot;,&quot;stop_name&quot;:&quot;Stop NameP&quot;}}</pre></div>
<p>You can pass those snippets to the application in a couple of ways. The simplest is directly on the command line.</p>
<div class="source"><pre class="prettyprint">--transform='{...}'</pre></div>
<p>You can have multiple <code>--transform</code> arguments to specify multiple transformations. However, if you have a LOT of transformations that you wish to apply, it can be easier to put them in a file, with a JSON snippet per line. Then specify the file on the command-line:</p>
<div class="source"><pre class="prettyprint">  --transform=path/to/local-file</pre></div>
<p>You can even specify a URL where the transformations will be read:</p>
<div class="source"><pre class="prettyprint">--transform=http://server/path</pre></div></section></section><section>
<h2><a name="Matching"></a>Matching </h2>
<p>We provide a number of configurable transformations out-of-the-box that can do simple operations like adding, updating, retaining, and removing GTFS entities. Many of the transforms accept a &quot;`match`&quot; term that controls how the rule matches against entities:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:..., &quot;match&quot;:{&quot;file&quot;:&quot;routes.txt&quot;, &quot;route_short_name&quot;:&quot;574&quot;}}</pre></div>
<p>Here, the match snippet at minimum requires a `file` property that specifies the type of GTFS entity to match. Any file name defined in the <a class="externalLink" href="https://developers.google.com/transit/gtfs/reference#FeedFiles">GTFS specification</a> can be used.</p>
<p>You can specify additional properties and values to match against as needed. Again, use the field names defined for each file name in the GTFS specification. For example, the snippet above will match any entry in `routes.txt` with a `route_short_name` value of `574`.</p><section>
<h3><a name="Regular_Expressions"></a>Regular Expressions</h3>
<p>Property matching also supports regular expressions that allow you to match property values conforming to a regexp pattern. For example, the snippet below will match any entry in `stops.txt` with a `stop_id` starting with `de:08`.</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:..., &quot;match&quot;:{&quot;file&quot;:&quot;stops.txt&quot;, &quot;stop_id&quot;:&quot;m/^de:08.*/&quot;}}</pre></div></section><section>
<h3><a name="Compound_Property_Expressions"></a>Compound Property Expressions</h3>
<p>Property matching also supports compound property expressions that allow you to match across GTFS relational references. Let's look at a simple example:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:..., &quot;match&quot;:{&quot;file&quot;:&quot;trips.txt&quot;, &quot;route.route_short_name&quot;:&quot;10&quot;}}</pre></div>
<p>Here the special `routes` property references the route entry associated with each trip, allowing you to match the properties of the route. You can even chain references, like `route.agency` to match against the agency associated with the trip. Here is the full list of supported compound property references:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:..., &quot;match&quot;:{&quot;file&quot;:&quot;routes.txt&quot;, &quot;agency.name&quot;:&quot;Metro&quot;}}
{&quot;op&quot;:..., &quot;match&quot;:{&quot;file&quot;:&quot;trips.txt&quot;, &quot;route.route_short_name&quot;:&quot;10&quot;}}
{&quot;op&quot;:..., &quot;match&quot;:{&quot;file&quot;:&quot;stop_times.txt&quot;, &quot;stop.stop_id&quot;:&quot;153&quot;}}
{&quot;op&quot;:..., &quot;match&quot;:{&quot;file&quot;:&quot;stop_times.txt&quot;, &quot;trip.route.route_type&quot;:3}}
{&quot;op&quot;:..., &quot;match&quot;:{&quot;file&quot;:&quot;frequencies.txt&quot;, &quot;trip.service_id&quot;:&quot;WEEKDAY&quot;}}
{&quot;op&quot;:..., &quot;match&quot;:{&quot;file&quot;:&quot;transfers.txt&quot;, &quot;fromStop.stop_id&quot;:&quot;173&quot;}}
{&quot;op&quot;:..., &quot;match&quot;:{&quot;file&quot;:&quot;transfers.txt&quot;, &quot;toStop.stop_id&quot;:&quot;173&quot;}}
{&quot;op&quot;:..., &quot;match&quot;:{&quot;file&quot;:&quot;fare_rules.txt&quot;, &quot;fare.currencyType&quot;:&quot;USD&quot;}}
{&quot;op&quot;:..., &quot;match&quot;:{&quot;file&quot;:&quot;fare_rules.txt&quot;, &quot;route.route_short_name&quot;:&quot;10&quot;}}</pre></div></section><section>
<h3><a name="Multi-Value_Matches"></a>Multi-Value Matches</h3>
<p>The compound property expressions shown above are all for 1-to-1 relations, but matching also supports a limited form of multi-value matching for 1-to-N relations. Let's look at a simple example:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:..., &quot;match&quot;:{&quot;file&quot;:&quot;routes.txt&quot;, &quot;any(trips.trip_headsign)&quot;:&quot;Downtown&quot;}}</pre></div>
<p>Notice the addition of `any(...)` around the property name. Here we are using a special `trips` property that expands to include all trips associated with each route. Now, if *any* trip belonging to the route has the specified `trip_headsign` value, then the route matches. Here is the full list of supported multi-value property matches:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:..., &quot;match&quot;:{&quot;file&quot;:&quot;agency.txt&quot;, &quot;any(routes.X)&quot;:&quot;Y&quot;}}
{&quot;op&quot;:..., &quot;match&quot;:{&quot;file&quot;:&quot;routes.txt&quot;, &quot;any(trips.X)&quot;:&quot;Y&quot;}}
{&quot;op&quot;:..., &quot;match&quot;:{&quot;file&quot;:&quot;trips.txt&quot;, &quot;any(stop_times.X)&quot;:&quot;Y&quot;}}</pre></div></section><section>
<h3><a name="Collection-Like_Entities"></a>Collection-Like Entities</h3>
<p>There are a number of GTFS entites that are more effectively collections identified by a common key. For example, shape points in `shapes.txt` linked by a common `shape_id` value or `calendar.txt` and `calendar_dates.txt` entries linked by a common `service_id` value. You can use a special `collection `match clause to match against the entire collection.</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:..., &quot;match&quot;:{&quot;collection&quot;:&quot;shape&quot;, &quot;shape_id&quot;:&quot;XYZ&quot;}}
{&quot;op&quot;:..., &quot;match&quot;:{&quot;collection&quot;:&quot;calendar&quot;, &quot;service_id&quot;:&quot;XYZ&quot;}}</pre></div>
<p>You can use the calendar collection matches, for example, to retain a calendar, including all `calendar.txt`, `calendar_dates.txt`, and `trip.txt` entries that reference the specified `service_id` value. This convenient short-hand is easier than writing the equivalent expression using references to the three file types separately. </p></section></section><section>
<h2><a name="Types_of_Transforms"></a>Types of Transforms</h2><section>
<h3><a name="Add_an_Entity"></a>Add an Entity</h3>
<p>Create and add a new entity to the feed.</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;add&quot;,&quot;obj&quot;:{&quot;file&quot;:&quot;agency.txt&quot;, &quot;agency_id&quot;:&quot;ST&quot;, &quot;agency_name&quot;:&quot;Sound Transit&quot;,
&quot;agency_url&quot;:&quot;http://www.soundtransit.org&quot;, &quot;agency_timezone&quot;:&quot;America/Los_Angeles&quot;}}</pre></div></section><section>
<h3><a name="Update_an_Entity"></a>Update an Entity</h3>
<p>You can update arbitrary fields of a GTFS entity.</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;update&quot;, &quot;match&quot;:{&quot;file&quot;:&quot;routes.txt&quot;, &quot;route_short_name&quot;:&quot;574&quot;}, &quot;update&quot;:{&quot;agency_id&quot;:&quot;ST&quot;}}</pre></div>
<p>Normally, update values are used as-is. However, we support a number of special update operations:</p><section>
<h4><a name="Find.2FReplace"></a>Find/Replace</h4>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;update&quot;, &quot;match&quot;:{&quot;file&quot;:&quot;trips.txt&quot;}, &quot;update&quot;:{&quot;trip_short_name&quot;:&quot;s/North/N/&quot;}}</pre></div>
<p>By using <code>s/.../.../</code> syntax in the update value, the update will perform a find-replace operation on the specified property value. Consider the following example:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;update&quot;, &quot;match&quot;:{&quot;file&quot;:&quot;trips.txt&quot;}, &quot;update&quot;:{&quot;trip_short_name&quot;:&quot;s/North/N/&quot;}}</pre></div>
<p>Here, a trip with a headsign of <code>North Seattle</code> will be updated to <code>N Seattle</code>.</p></section><section>
<h4><a name="Path_Expressions"></a>Path Expressions </h4>
<p>By using <code>path(...)</code> syntax in the update value, the expression will be treated as a compound Java bean properties path expression. This path expression will be evaluated against the target entity to produce the update value. Consider the following example:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;update&quot;, &quot;match&quot;:{&quot;file&quot;:&quot;trips.txt&quot;}, &quot;update&quot;:{&quot;trip_short_name&quot;:&quot;path(route.longName)&quot;}}</pre></div>
<p>Here, the <code>trip_short_name</code> field is updated for each trip in the feed. The value will be copied from the <code>route_long_name</code> field of each trip's associated route.</p></section></section><section>
<h3><a name="Retain_an_Entity"></a>Retain an Entity</h3>
<p>We also provide a powerful mechanism for selecting just a sub-set of a feed. You can apply retain operations to entities you wish to keep and all the supporting entities referenced by the retained entity will be retained as well. Unreferenced entities will be pruned.</p>
<p>In the following example, only route B15 will be retained, along with all the stops, trips, stop times, shapes, and agencies linked to directly by that route.</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;retain&quot;, &quot;match&quot;:{&quot;file&quot;:&quot;routes.txt&quot;, &quot;route_short_name&quot;:&quot;B15&quot;}}</pre></div>
<p>By default, we retain across <a class="externalLink" href="https://developers.google.com/transit/gtfs/reference#trips_block_id_field">block_id</a> values specified in trips.txt. That means if a particular trip is retained (perhaps because its parent route is retained), and the trip specifies a block_id, then all the trips referencing that block_id will be retained as well, along with their own routes, stop times, and shapes. This can potentially lead to unexpected results if you retain one route and suddenly see other routes included because they are linked by block_id.</p>
<p>You can disable this feature by specifying <code>retainBlocks: false</code> in the JSON transformer snippet. Here is an example:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;retain&quot;,&quot;match&quot;:{&quot;file&quot;:&quot;routes.txt&quot;, &quot;route_short_name&quot;:&quot;B15&quot;}, &quot;retainBlocks&quot;:false}</pre></div></section><section>
<h3><a name="Remove_an_Entity"></a>Remove an Entity</h3>
<p>You can remove a specific entity from a feed.</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;remove&quot;, &quot;match&quot;:{&quot;file&quot;:&quot;stops.txt&quot;, &quot;stop_name&quot;:&quot;Stop Name&quot;}}</pre></div>
<p>Note that removing an entity has a cascading effect. If you remove a trip, all the stop times that depend on that trip will also be removed. If you remove a route, all the trips and stop times for that route will be removed.</p></section><section>
<h3><a name="Trim_a_Trip"></a>Trim a Trip</h3>
<p>You can remove stop times from the beginning or end of a trip using the &quot;trim_trip&quot; operation. Example:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;trim_trip&quot;, &quot;match&quot;:{&quot;file&quot;:&quot;trips.txt&quot;, &quot;route_id&quot;:&quot;R10&quot;}, &quot;from_stop_id&quot;:&quot;138S&quot;}</pre></div>
<p>For any trip belonging to the specified route and passing through the specified stop, all stop times from the specified stop onward will be removed from the trip. You can also remove stop times from the beginning of the trip as well:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;trim_trip&quot;, &quot;match&quot;:{&quot;file&quot;:&quot;trips.txt&quot;, &quot;route_id&quot;:&quot;R10&quot;}, &quot;to_stop_id&quot;:&quot;138S&quot;}</pre></div>
<p>Or both:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;trim_trip&quot;, &quot;match&quot;:{&quot;file&quot;:&quot;trips.txt&quot;, &quot;route_id&quot;:&quot;R10&quot;}, &quot;to_stop_id&quot;:&quot;125S&quot;, &quot;from_stop_id&quot;:&quot;138S&quot;}</pre></div></section><section>
<h3><a name="Generate_Stop_Times"></a>Generate Stop Times</h3>
<p>You can generate stop time entries for a trip. Example:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;stop_times_factory&quot;, &quot;trip_id&quot;:&quot;TRIP01&quot;, &quot;start_time&quot;:&quot;06:00:00&quot;, &quot;end_time&quot;:&quot;06:20:00&quot;, &quot;stop_ids&quot;:[&quot;S01&quot;, &quot;S02&quot;, &quot;S03&quot;]}</pre></div>
<p>A series of entries in `stop_times.txt` will be generated for the specified trip, traveling along the specified sequence of stops. The departure time for the first stop will be set from the `start_time` field, the arrival time for the last stop will be set from the `end_time` field, and the times for intermediate stops will be interpolated based on their distance along the trip.</p></section><section>
<h3><a name="Extend_Service_Calendars"></a>Extend Service Calendars</h3>
<p>Sometimes you need to extend the service dates in a GTFS feed, perhaps in order to temporarily extend an expired feed. Extending the feed by hand can be a tedious task, especially when the feed uses a complex combination of `calendar.txt` and `calendar_dates.txt` entries. Fortunately, the GTFS tranformer tool supports a `calendar_extension` operation that can help simplify the work. Example:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;calendar_extension&quot;, &quot;end_date&quot;:&quot;20130331&quot;}</pre></div>
<p>The operation requires just one argument by default: `end_date` to specify the new end-date for the feed. The operation does its best to intelligently extend each service calendar, as identified by a `service_id` in `calendar.txt` or `calendar_dates.txt`. There are a few wrinkles to be aware of, however.</p>
<p>Extending a `calendar.txt` entry is usually just a matter of setting a new `end_date` value in the feed. Extending a service calendar represented only through `calendar_dates.txt` entries is a bit more complex. For such a service calendar, we attempt to determine which days of the week are typically active for the calendar and extend only those. For example, is the calendar is always active on Saturday but has one or two Sunday entries, we will only add entries for Saturday when extending the calendar.</p>
<p>Also note that we will not extend &quot;inactive&quot; service calendars. A service calendar is considered inactive if its last active service date is already in the past. By default, any calendar that's been expired for more than two weeks is considered inactive. This helps handle feeds that have merged two service periods in one feed. For example, one calendar active from June 1 - July 31 and a second calendar active from August 1 to September 31. If it's the last week of September and you are extending the feed, you typically only mean to extend the second service calendar. You can control this inactive calendar cutoff with an optional argument:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;calendar_extension&quot;, &quot;end_date&quot;:&quot;20130331&quot;, &quot;inactive_calendar_cutoff&quot;:&quot;20121031&quot;}</pre></div>
<p>Calendars that have expired before the specified date will be considered inactive and won't be extended.</p>
<p><b>Note</b>: We don't make any effort to extend canceled service dates, as specified in `calendar_dates.txt` for holidays and other special events. It's too tricky to automatically determine how they should be handled. You may need to still handle those manually. </p></section><section>
<h3><a name="Deduplicate_Calendar_Entries"></a>Deduplicate Calendar Entries</h3>
<p>Finds GTFS service_ids that have the exact same set of active days and consolidates each set of duplicated ids to a single service_id entry.</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;deduplicate_service_ids&quot;}</pre></div></section><section>
<h3><a name="Merge_Trips_and_Simplify_Calendar_Entries"></a>Merge Trips and Simplify Calendar Entries</h3>
<p>Some agencies model their transit schedule favoring multiple entries in calendar_dates.txt as opposed to a more concise entry in calendar.txt. A smaller number of agencies take this scheme even further, creating trips.txt entries for each service date, even when the underlying trips are exactly the same. This can cause the size of the GTFS to grow dramatically as trips and stop times are duplicated.</p>
<p>We provide a simple transformer that can attempt to detect these duplicate trips, remove them, and simplify the underlying calendar entries to match. To run it, apply the following transform:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;calendar_simplification&quot;}</pre></div>
<p>The transform takes additional optional arguments to control its behavior:</p>
<ul>
<li>min_number_of_weeks_for_calendar_entry - how many weeks does a service id need to span before it gets its own entry in calendar.txt (default=3)</li>
<li>day_of_the_week_inclusion_ratio - if a service id is being modeled with a calendar.txt entry, how frequent does a day of the week need to before it's modeled positively in calendar.txt with any negative exceptions noted in calendar_dates.txt, vs making no entry for that day of the week in calendar.txt and instead noting any positive exceptions in calendar_dates.txt. This is useful for filtering out a calendar that is always active on Sunday, but has one or two Mondays for a holiday. Frequency is defined as how often the target day of the week occurs vs the count for day of the week appearing MOST frequently for the service id (default=0.5)</li>
<li>undo_google_transit_data_feed_merge_tool - set to true to indicate that merged trip ids, as produced by the <a class="externalLink" href="http://code.google.com/p/googletransitdatafeed/wiki/Merge">GoogleTransitDataFeedMergeTool</a>, should be un-mangled where possible. Merged trip ids will often have the form <code>OriginalTripId_merged_1234567</code>. We attempt to set the trip id back to <code>OrginalTripId</code> where appropriate.</li></ul></section><section>
<h3><a name="Shift_Negative_Stop_Times"></a>Shift Negative Stop Times</h3>
<p>Some agencies have trips that they model as starting BEFORE midnight on a given service date. For these agencies, it would be convenient to represent these trips with negative arrival and departure times in stop_times.txt. The GTFS spec and many GTFS consumers do not support negative stop times, however.</p>
<p>To help these agencies, we provide a transform to &quot;fix&quot; GTFS feeds with negative stop times by identifying such trips, shifting the arrival and departure times to make them positive, and updating the service calendar entries for these trips such that the resulting schedule is semantically the same.</p>
<p>To run it, apply the following transform:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;shift_negative_stop_times&quot;}</pre></div>
<p><b>A note on negative stop times:</b> When writing negative stop times, the negative value ONLY applies to the hour portion of the time. Here are a few examples:</p>
<ul>
<li>&quot;-01:45:00&quot; =&gt; &quot;23:45:00&quot; on the previous day</li>
<li>&quot;-05:13:32&quot; =&gt; &quot;19:13:32&quot; on the previous day </li></ul></section><section>
<h3><a name="Remove_non-revenue_stops"></a>Remove non-revenue stops</h3>
<p>Stop_times which do not allow pick up or drop off are also known as non-revenue stops. Some GTFS consumers display these stops as if they were stops that passengers can use, at which point it is helpful to remove them. </p>
<p>To remove them, apply the following transform:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;remove_non_revenue_stops&quot;}</pre></div>
<p>Terminals (the first and last stop_time of a trip) can be excluded from removal with the following transform:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;remove_non_revenue_stops_excluding_terminals&quot;}}</pre></div></section><section>
<h3><a name="Replacing_trip_headsign_with_the_last_stop"></a>Replacing trip_headsign with the last stop</h3>
<p>Certain feeds contain unhelpful or incorrect trip_headsign. They can be replaced with the last stop's stop_name.</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;last_stop_to_headsign&quot;}</pre></div></section><section>
<h3><a name="Arbitrary_Transform"></a>Arbitrary Transform</h3>
<p>We also allow you to specify arbitrary transformations as well. Here, you specify your transformation class and we will automatically instantiate it for use in the transform pipeline.</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;transform&quot;, &quot;class&quot;:&quot;some.class.implementing.GtfsTranformStrategy&quot;}</pre></div>
<p>We additionally provide a mechanism for setting additional properties of the transform. For all additional properties specified in the JSON snippet, we will attempt to set that Java bean property value on the instantiated transformation object. See for example:</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;transform&quot;, &quot;class&quot;:&quot;org.onebusaway.gtfs_transformer.updates.ShapeTransformStrategy&quot;, &quot;shape_id&quot;:&quot;6010031&quot;, \
&quot;shape&quot;:&quot;wjb~G|abmVpAz]v_@@?wNE_GDaFs@?@dFX`GGjN__@A&quot;}</pre></div>
<p>Here, we set additional properties on the `ShapeTransformStrategy`, making it possible to reuse and configure a generic transformer to your needs.</p></section></section><section>
<h2><a name="Additional_Examples"></a>Additional Examples</h2><section>
<h3><a name="How_to_Reduce_your_GTFS"></a>How to Reduce your GTFS</h3>
<p>We can apply a modification that retains certain GTFS entities and all other entities required directly or indirectly by those entities. For example, create a file with the following contents (call it modifications.txt, as an example):</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;retain&quot;, &quot;match&quot;:{&quot;file&quot;:&quot;routes.txt&quot;, &quot;route_short_name&quot;:&quot;B15&quot;}}
{&quot;op&quot;:&quot;retain&quot;, &quot;match&quot;:{&quot;file&quot;:&quot;routes.txt&quot;, &quot;route_short_name&quot;:&quot;B62&quot;}}
{&quot;op&quot;:&quot;retain&quot;, &quot;match&quot;:{&quot;file&quot;:&quot;routes.txt&quot;, &quot;route_short_name&quot;:&quot;B63&quot;}}
{&quot;op&quot;:&quot;retain&quot;, &quot;match&quot;:{&quot;file&quot;:&quot;routes.txt&quot;, &quot;route_short_name&quot;:&quot;BX19&quot;}}
{&quot;op&quot;:&quot;retain&quot;, &quot;match&quot;:{&quot;file&quot;:&quot;routes.txt&quot;, &quot;route_short_name&quot;:&quot;Q54&quot;}}
{&quot;op&quot;:&quot;retain&quot;, &quot;match&quot;:{&quot;file&quot;:&quot;routes.txt&quot;, &quot;route_short_name&quot;:&quot;S53&quot;}}</pre></div>
<p>Then run:</p>
<div class="source"><pre class="prettyprint">java -jar onebusaway-gtfs-transformer-cli.jar --transform=modifications.txt source-gtfs.zip target-gtfs.zip</pre></div>
<p>The resulting GTFS will have the retained only the routes with the matching short names and all other entities required to support those routes.</p></section><section>
<h3><a name="Add_a_Full_Schedule_to_an_Existing_Feed"></a>Add a Full Schedule to an Existing Feed</h3>
<p>Consider an existing feed with a number of routes and stops. We can add an entirely new route, with trips and stop-times and frequency-based service, using the transform. This can be handy to add temporary service to an existing feed.</p>
<div class="source"><pre class="prettyprint">{&quot;op&quot;:&quot;add&quot;, &quot;obj&quot;:{&quot;file&quot;:&quot;routes.txt&quot;, &quot;route_id&quot;:&quot;r0&quot;, &quot;route_long_name&quot;:&quot;Temporary Shuttle&quot;, &quot;route_type&quot;:3}}

{&quot;op&quot;:&quot;add&quot;, &quot;obj&quot;:{&quot;file&quot;:&quot;calendar.txt&quot;, &quot;service_id&quot;:&quot;WEEKDAY&quot;, &quot;start_date&quot;:&quot;20120601&quot;, &quot;end_date&quot;:&quot;20130630&quot;, &quot;monday&quot;:1, &quot;tuesday&quot;:1, &quot;wednesday&quot;:1, &quot;thursday&quot;:1, &quot;friday&quot;:1}}

{&quot;op&quot;:&quot;add&quot;, &quot;obj&quot;:{&quot;file&quot;:&quot;trips.txt&quot;, &quot;trip_id&quot;:&quot;t0&quot;, &quot;route_id&quot;:&quot;r0&quot;, &quot;service_id&quot;:&quot;WEEKDAY&quot;, &quot;trip_headsign&quot;:&quot;Inbound&quot;}}
{&quot;op&quot;:&quot;add&quot;, &quot;obj&quot;:{&quot;file&quot;:&quot;trips.txt&quot;, &quot;trip_id&quot;:&quot;t1&quot;, &quot;route_id&quot;:&quot;r0&quot;, &quot;service_id&quot;:&quot;WEEKDAY&quot;, &quot;trip_headsign&quot;:&quot;Outbound&quot;}}

{&quot;op&quot;:&quot;add&quot;,&quot;obj&quot;:{&quot;file&quot;:&quot;frequencies.txt&quot;,&quot;trip_id&quot;:&quot;t0&quot;,&quot;start_time&quot;:&quot;06:00:00&quot;,&quot;end_time&quot;:&quot;22:00:00&quot;,&quot;headway_secs&quot;:900}}
{&quot;op&quot;:&quot;add&quot;,&quot;obj&quot;:{&quot;file&quot;:&quot;frequencies.txt&quot;,&quot;trip_id&quot;:&quot;t1&quot;,&quot;start_time&quot;:&quot;06:00:00&quot;,&quot;end_time&quot;:&quot;22:00:00&quot;,&quot;headway_secs&quot;:900}}

{&quot;op&quot;:&quot;stop_times_factory&quot;, &quot;trip_id&quot;:&quot;t0&quot;, &quot;start_time&quot;:&quot;06:00:00&quot;, &quot;end_time&quot;:&quot;06:20:00&quot;, &quot;stop_ids&quot;:[&quot;s0&quot;, &quot;s1&quot;, &quot;s2&quot;, &quot;s3&quot;]}
{&quot;op&quot;:&quot;stop_times_factory&quot;, &quot;trip_id&quot;:&quot;t1&quot;, &quot;start_time&quot;:&quot;06:00:00&quot;, &quot;end_time&quot;:&quot;06:20:00&quot;, &quot;stop_ids&quot;:[&quot;s3&quot;, &quot;s2&quot;, &quot;s1&quot;, &quot;s0&quot;]}</pre></div></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2023
<a href="http://onebusaway.org/">OneBusAway</a>
</p>
        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>
